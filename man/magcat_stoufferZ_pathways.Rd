% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Stouffer_wrappers.R
\name{magcat_stoufferZ_pathways}
\alias{magcat_stoufferZ_pathways}
\title{Pathway-level (weighted) Stouffer Z test on MAGMA gene Z statistics}
\usage{
magcat_stoufferZ_pathways(
  gene_results,
  pathways = NULL,
  species = NULL,
  pmn_gene_col = NULL,
  gene_col = "GENE",
  z_col = "ZSTAT",
  weight_col = NULL,
  min_abs_w = 1e-08,
  B_perm = 0L,
  perm_mode = c("resample_global", "mvn"),
  magma_genes_out = NULL,
  magma_cor_file = NULL,
  make_PD = TRUE,
  seed = NULL,
  output = FALSE,
  out_dir = "magcat_stouffer_z"
)
}
\arguments{
\item{gene_results}{data.frame with at least gene + Z columns.
Typically MAGMA \code{.genes.out} (or your merged file) with \code{gene_col} and \code{z_col}.}

\item{pathways}{either:
\itemize{
\item a named list: each element is a character vector of gene IDs in that pathway, OR
\item a data.frame with columns \code{pathway_id}, \code{gene_id} (and optional \code{pathway_name}).
}}

\item{species}{optional; one of "maize", "sorghum", "arabidopsis", "plant".
If provided, built-in PMN pathways are loaded via \code{magcat_load_pathways()}.
Provide either \code{pathways} OR \code{species}, but not both.}

\item{pmn_gene_col}{optional; passed to \code{magcat_load_pathways(gene_col=...)} when \code{species} is used.}

\item{gene_col}{column name in \code{gene_results} containing gene IDs (default "GENE").}

\item{z_col}{column name in \code{gene_results} containing gene-level Z statistics (default "ZSTAT").}

\item{weight_col}{optional column name in \code{gene_results} for per-gene weights (default NULL = equal weights).}

\item{min_abs_w}{replace non-finite / <=0 weights by this small positive value (default 1e-8).}

\item{B_perm}{integer; number of permutations for empirical p (default 0L = no permutations).}

\item{perm_mode}{either "resample_global" or "mvn" (default "resample_global").}

\item{magma_genes_out}{required if perm_mode="mvn"; path to merged MAGMA *.genes.out (must include CHR).}

\item{magma_cor_file}{optional if perm_mode="mvn"; 3-col file gene1 gene2 r of gene-gene correlations.}

\item{make_PD}{logical; if TRUE, force correlation matrix PSD (default TRUE).}

\item{seed}{optional RNG seed (default NULL).}

\item{output}{logical; if TRUE, write a CSV of results to \code{out_dir}.}

\item{out_dir}{directory to write CSV when \code{output = TRUE} (default "magcat_stouffer_z").}
}
\value{
data.frame with columns:
\itemize{
\item pathway_id
\item pathway_name
\item n_genes
\item gene_names
\item gene_zvals           (semicolon-separated Z's used)
\item stouffer_Z
\item stouffer_p_analytic  (two-sided analytic p)
\item stouffer_p_perm      (perm p; NA if B_perm = 0)
Sorted by \code{stouffer_p_perm} ascending if B_perm>0 else by \code{stouffer_p_analytic}.
If \code{output = TRUE}, attribute \code{"file"} contains the CSV path.
}
}
\description{
For each pathway:
\itemize{
\item take gene-level Z statistics (e.g. MAGMA \code{.genes.out} has a Z column),
\item optionally apply weights (e.g. sqrt(NSNPS), 1/SE, etc.),
\item compute the weighted Stouffer Z:
Z_S = sum_i w_i Z_i / sqrt(sum_i w_i^2),
and return a two-sided p-value p = 2 * Phi(-|Z_S|).
}
}
\details{
Optional permutation calibration:
\itemize{
\item perm_mode="resample_global": resample Z's from the global pool (exchangeable null)
\item perm_mode="mvn": simulate correlated null Z's using MAGMA gene correlation
}

IMPORTANT:
\itemize{
\item If your Z's have direction, this keeps direction (unlike p-value Stouffer-from-p).
\item Use \code{B_perm > 0} if you want empirical p-values that account for correlation.
}
}
