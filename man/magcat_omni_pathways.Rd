% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/OMNI_ACAT_wrappers.R
\name{magcat_omni_pathways}
\alias{magcat_omni_pathways}
\title{Omnibus (ACAT-O) pathway test}
\usage{
magcat_omni_pathways(
  gene_results = NULL,
  pathways = NULL,
  species = NULL,
  pmn_gene_col = NULL,
  gene_col = "GENE",
  p_col = "P",
  effect_col = "ZSTAT",
  weight_col = NULL,
  is_onetail = FALSE,
  min_p = 1e-15,
  do_fix = TRUE,
  ptrunc = 0.05,
  B_perm = 0L,
  seed = NULL,
  output = FALSE,
  out_dir = "magcat_omni",
  tab = NULL,
  id_col = "pathway_id",
  p_cols = NULL
)
}
\arguments{
\item{gene_results}{data.frame with at least gene + p-value columns.
Typically a MAGMA \code{.genes.out} file, with "GENE" and "P" (and "ZSTAT").
Only used when \code{tab = NULL}.}

\item{pathways}{either:
\itemize{
\item a named list: each element is a character vector of gene IDs
in that pathway, OR
\item a data.frame with columns \code{pathway_id}, \code{gene_id}
(and optional \code{pathway_name}).
}
Only used when \code{tab = NULL}.}

\item{species}{optional; one of "maize", "sorghum", "arabidopsis", "plant".
If provided, built-in PMN pathways are loaded via \code{magcat_load_pathways()}.
You must provide either \code{pathways} OR \code{species}, but not both.
Only used when \code{tab = NULL}.}

\item{pmn_gene_col}{optional; passed to \code{magcat_load_pathways(gene_col=...)}
when \code{species} is used.}

\item{gene_col}{column name in \code{gene_results} containing gene IDs
(default "GENE").}

\item{p_col}{column name in \code{gene_results} containing gene-level p-values
(default "P").}

\item{effect_col}{column with effect size / Z-statistic to derive direction
(default "ZSTAT"). Only used when \code{is_onetail = FALSE}.}

\item{weight_col}{optional column in \code{gene_results} to use as weight
for wFisher (e.g. "NSNPS"). If NULL, all weights = 1.}

\item{is_onetail}{logical; passed to wFisher (\code{is.onetail=...}).
Default FALSE (two-sided p-values + directions).}

\item{min_p}{lower cap for very small p-values (default 1e-15).}

\item{do_fix}{logical; if TRUE, clean p-values with \code{fix_p_for_acat()}
(0 -> \code{min_p}, 1 -> \code{1 - 1/d}).}

\item{ptrunc}{truncation threshold for truncated Fisher TPM (default 0.05).}

\item{B_perm}{Integer; number of gene-set permutations for empirical
omnibus p-values. Default 0 (no permutations). Only used when \code{tab = NULL}.}

\item{seed}{optional integer random seed for permutations (ignored if
\code{B_perm == 0}).}

\item{output}{logical; if TRUE, write a CSV of results to \code{out_dir}.}

\item{out_dir}{directory to write CSV when \code{output = TRUE}
(default "magcat_omni").}

\item{tab}{Optional: if non-NULL, use table mode. Either a data.frame
or a single CSV file path with columns including \code{id_col} and \code{p_cols}.}

\item{id_col}{Name of pathway ID column in \code{tab} (default "pathway_id").}

\item{p_cols}{Character vector of column names in \code{tab} that contain
p-values to be combined by ACAT-O (length >= 1).}
}
\value{
\strong{Table mode (\code{tab} not NULL)}: \cr
data.frame with \code{id_col}, \code{p_cols}, \code{omni_p},
and BH/qvalue-adjusted omni p-values. \cr

\strong{Pipeline mode (\code{tab} = NULL)}: \cr
data.frame with columns:
\describe{
\item{pathway_id}{pathway identifier}
\item{pathway_name}{pathway name}
\item{n_genes}{number of genes used}
\item{gene_names}{semicolon-separated gene IDs}
\item{acat_p}{ACAT pathway p-value}
\item{wfisher_p}{wFisher pathway p-value}
\item{tpm_p}{truncated Fisher (TPM) pathway p-value (chi-square approx)}
\item{omni_p}{ACAT-O combined p-value of the three methods}
\item{omni_perm_p}{empirical omnibus p-value from permutations
(NA if \code{B_perm == 0})}
\item{acat_p_BH}{BH FDR for \code{acat_p}}
\item{wfisher_p_BH}{BH FDR for \code{wfisher_p}}
\item{tpm_p_BH}{BH FDR for \code{tpm_p}}
\item{omni_p_BH}{BH FDR for \code{omni_p}}
\item{omni_perm_p_BH}{BH FDR for \code{omni_perm_p} (if \code{B_perm > 0})}
\item{acat_p_q}{qvalue for \code{acat_p} (if \code{qvalue} installed)}
\item{wfisher_p_q}{qvalue for \code{wfisher_p}}
\item{tpm_p_q}{qvalue for \code{tpm_p}}
\item{omni_p_q}{qvalue for \code{omni_p}}
\item{omni_perm_p_q}{qvalue for \code{omni_perm_p} (if \code{B_perm > 0})}
}
}
\description{
Two usage modes:
}
\details{
\strong{1) From MAGMA gene-level results (full pipeline)}\cr
\itemize{
\item Provide \code{gene_results} + \code{pathways} or \code{species}. \cr
\item For each pathway, compute:
\itemize{
\item ACAT on gene p-values,
\item wFisher (optionally weighted by \code{weight_col}),
\item truncated Fisher TPM (ptrunc),
then combine them with ACAT-O (via \code{sumFREGAT::ACATO}).
}
\item Optionally perform gene-set permutations for empirical omnibus p-values.
}

\strong{2) From an existing table of pathway-level p-values}\cr
\itemize{
\item Provide \code{tab} (data.frame or CSV path), \code{id_col}, and \code{p_cols}. \cr
\item For each row (pathway), apply ACAT-O across the p-columns in \code{p_cols}.
}

Multiple-testing correction:
\itemize{
\item BH FDR (Benjaminiâ€“Hochberg) is computed for omni and component p-values.
\item If the \code{qvalue} package is installed, q-values are also reported.
}
}
